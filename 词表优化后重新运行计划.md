# è¯è¡¨ä¼˜åŒ–åé‡æ–°è¿è¡Œè®¡åˆ’

**åˆ›å»ºæ—¶é—´**ï¼š2025-12-15  
**åŸå› **ï¼šè¯è¡¨å·²å¤§å¹…ä¼˜åŒ–ï¼ˆå»é‡+è´¨é‡æ¸…ç†ï¼‰

---

## ğŸ“Š è¯è¡¨å˜åŒ–ç»Ÿè®¡

| è¯è¡¨ | ä¼˜åŒ–å‰ | ä¼˜åŒ–å | å‡å°‘æ¯”ä¾‹ |
|------|--------|--------|----------|
| **porn.txt** | 7,390 | ~896 | **-87.9%** |
| **politics.txt** | 17,338 | ~3,703 | **-78.6%** |
| **abuse.txt** | 11,284 | ~1,276 | **-88.7%** |
| **æ€»è®¡** | 36,012 | ~5,875 | **-83.7%** |

**å˜åŒ–è¯´æ˜**ï¼š
- å¤§å¹…å‡å°‘å™ªå£°è¯ï¼ˆå¦‚politics.txtä¸­çš„Androidã€Appç­‰é€šç”¨è¯ï¼‰
- ä¿ç•™é«˜è´¨é‡æ•æ„Ÿè¯
- è¯è¡¨è´¨é‡æ˜¾è‘—æå‡

---

## ğŸ”„ ä¾èµ–å…³ç³»åˆ†æ

### ç›´æ¥ä¾èµ–è¯è¡¨çš„Day

| Day | è„šæœ¬ | è¾“å‡ºæ–‡ä»¶ | æ˜¯å¦å¿…é¡»é‡æ–°ç”Ÿæˆ |
|-----|------|---------|-----------------|
| **Day6** | `q0_builder.py` | `data/q0_*.jsonl` | âœ… **å¿…é¡»** |
| **Day10** | `pkri_feature_builder.py` | `output/pkri_features_*.csv` | âœ… **å¿…é¡»** |
| **Day10** | `pkri_train.py` | `output/pkri_model.pkl` | âœ… **å¿…é¡»**ï¼ˆç‰¹å¾å˜äº†ï¼‰ |
| **Day10** | `pkri_train.py` | `data/qpkri_*.jsonl` | âœ… **å¿…é¡»** |

### é—´æ¥ä¾èµ–çš„Dayï¼ˆé€šè¿‡q0æ–‡ä»¶ï¼‰

| Day | è„šæœ¬ | è¾“å‡ºæ–‡ä»¶ | æ˜¯å¦éœ€è¦é‡æ–°ç”Ÿæˆ |
|-----|------|---------|-----------------|
| **Day7** | `emg_bucket_search.py` | `output/bucket_alpha_star.csv` | âš ï¸ **å»ºè®®**ï¼ˆq0å˜äº†ï¼ŒÎ±*ä¼šä¸åŒï¼‰ |
| **Day8** | `emg_fit_alpha_u.py` | `output/alpha_u_lut.json` | âš ï¸ **å»ºè®®**ï¼ˆä¾èµ–Day7ï¼‰ |
| **Day9** | `eval_emg.py` | è¯„ä¼°ç»“æœ | âš ï¸ **å»ºè®®**ï¼ˆä¾èµ–Î±(u)å’Œq0ï¼‰ |

**æ³¨æ„**ï¼š
- Day7å’ŒDay8çš„è¾“å‡ºè™½ç„¶ä¸ç›´æ¥ä¾èµ–è¯è¡¨ï¼Œä½†å› ä¸ºq0å˜äº†ï¼ŒÎ±*æœç´¢ç»“æœä¼šä¸åŒ
- å¦‚æœè¦éªŒè¯ä¼˜åŒ–1å’Œ2çš„æ•ˆæœï¼Œå»ºè®®ä½¿ç”¨**æœ€æ–°çš„q0**é‡æ–°è¿è¡ŒDay7å’ŒDay8

---

## âœ… éªŒè¯ä¼˜åŒ–1å’Œ2çš„å®Œæ•´æµç¨‹

### æ–¹æ¡ˆAï¼šå®Œæ•´é‡æ–°è¿è¡Œï¼ˆæ¨èï¼Œç¡®ä¿ä¸€è‡´æ€§ï¼‰

**æ­¥éª¤1ï¼šé‡æ–°ç”Ÿæˆq0ï¼ˆDay6ï¼‰**
```bash
python scripts/q0_builder.py --datasets train dev test
```

**æ­¥éª¤2ï¼šé‡æ–°è¿è¡ŒDay7ï¼ˆÎ±*æœç´¢ï¼‰**
```bash
python scripts/emg_bucket_search.py
```
- è¾“å…¥ï¼š`data/dev_with_uncertainty.jsonl` + `data/q0_dev.jsonl`ï¼ˆæ–°ç”Ÿæˆçš„ï¼‰
- è¾“å‡ºï¼š`output/bucket_alpha_star.csv`

**æ­¥éª¤3ï¼šé‡æ–°è¿è¡ŒDay8ï¼ˆÎ±(u)æ‹Ÿåˆï¼‰**
```bash
python scripts/emg_fit_alpha_u.py
```
- è¾“å…¥ï¼š`output/bucket_alpha_star.csv`ï¼ˆæ–°ç”Ÿæˆçš„ï¼‰
- è¾“å‡ºï¼š`output/alpha_u_lut.json`

**æ­¥éª¤4ï¼šé‡æ–°ç”ŸæˆPKRIç‰¹å¾ï¼ˆDay10-1ï¼‰**
```bash
# è®­ç»ƒé›†
python scripts/pkri_feature_builder.py \
    --dataset-file data/train_with_subtypes.jsonl \
    --lexicon-dir configs/lexicons \
    --output-file output/pkri_features_train.csv

# éªŒè¯é›†
python scripts/pkri_feature_builder.py \
    --dataset-file data/dev_with_subtypes.jsonl \
    --lexicon-dir configs/lexicons \
    --output-file output/pkri_features_dev.csv

# æµ‹è¯•é›†
python scripts/pkri_feature_builder.py \
    --dataset-file data/test_with_subtypes.jsonl \
    --lexicon-dir configs/lexicons \
    --output-file output/pkri_features_test.csv
```

**æ­¥éª¤5ï¼šé‡æ–°è®­ç»ƒPKRIæ¨¡å‹å¹¶ç”Ÿæˆq_PKRIï¼ˆDay10-2ï¼Œä½¿ç”¨ä¼˜åŒ–1å’Œ2ï¼‰**
```bash
python scripts/pkri_train.py \
    --train-features output/pkri_features_train.csv \
    --dev-features output/pkri_features_dev.csv \
    --test-features output/pkri_features_test.csv \
    --train-dataset data/train_with_subtypes.jsonl \
    --dev-dataset data/dev_with_subtypes.jsonl \
    --test-dataset data/test_with_subtypes.jsonl \
    --model-type lr \
    --calibration-method platt \
    --output-model output/pkri_model.pkl \
    --output-qpkri-dir data \
    --confidence-mapping tanh \
    --build-method improved_weighted
```

**æ­¥éª¤6ï¼šéªŒè¯ä¼˜åŒ–æ•ˆæœ**
```bash
# å¯¹æ¯”q0 vs q_PKRIï¼ˆä¼˜åŒ–åï¼‰
python scripts/analyze_q0_vs_qpkri.py \
    --q0-file data/q0_test.jsonl \
    --qpkri-file data/qpkri_test.jsonl \
    --baseline-file data/test_with_uncertainty.jsonl \
    --output-dir output

# è¯„ä¼°EMG+q_PKRIæ•ˆæœ
python scripts/eval_emg.py \
    --baseline-file data/test_with_uncertainty.jsonl \
    --q0-file data/qpkri_test.jsonl \
    --alpha-lut-file output/alpha_u_lut.json \
    --knowledge-source qpkri \
    --use-consistency-gating \
    --output-dir output
```

---

### æ–¹æ¡ˆBï¼šæœ€å°åŒ–é‡æ–°è¿è¡Œï¼ˆå¿«é€ŸéªŒè¯ä¼˜åŒ–1å’Œ2ï¼‰

**ä»…é‡æ–°è¿è¡ŒDay10**ï¼ˆå› ä¸ºä¼˜åŒ–1å’Œ2ä¸»è¦åœ¨PKRIä¸­ï¼‰ï¼š
- âŒ **ä¸æ¨è**ï¼šå› ä¸ºç‰¹å¾ä¾èµ–è¯è¡¨ï¼Œè¯è¡¨å˜äº†ç‰¹å¾ä¹Ÿä¼šå˜
- âœ… **å¿…é¡»é‡æ–°ç”Ÿæˆ**ï¼šPKRIç‰¹å¾å’Œæ¨¡å‹

**å¦‚æœéœ€è¦å¯¹æ¯”ä¼˜åŒ–å‰åæ•ˆæœ**ï¼Œå»ºè®®ä½¿ç”¨æ–¹æ¡ˆAï¼ˆå®Œæ•´é‡æ–°è¿è¡Œï¼‰ã€‚

---

## ğŸ“‹ æ‰§è¡Œé¡ºåºæ€»ç»“

### å¿…é¡»é‡æ–°è¿è¡Œï¼ˆè¯è¡¨ç›´æ¥ä¾èµ–ï¼‰

1. âœ… **Day6**ï¼šé‡æ–°ç”Ÿæˆq0
   ```bash
   python scripts/q0_builder.py --datasets train dev test
   ```

2. âœ… **Day10-1**ï¼šé‡æ–°ç”ŸæˆPKRIç‰¹å¾
   ```bash
   # train/dev/testä¸‰ä¸ªæ•°æ®é›†
   ```

3. âœ… **Day10-2**ï¼šé‡æ–°è®­ç»ƒPKRIæ¨¡å‹ï¼ˆä½¿ç”¨ä¼˜åŒ–1å’Œ2ï¼‰
   ```bash
   # ä½¿ç”¨--confidence-mapping tanh --build-method improved_weighted
   ```

### å»ºè®®é‡æ–°è¿è¡Œï¼ˆä¿è¯ä¸€è‡´æ€§ï¼‰

4. âš ï¸ **Day7**ï¼šé‡æ–°æœç´¢Î±*ï¼ˆå› ä¸ºq0å˜äº†ï¼‰
   ```bash
   python scripts/emg_bucket_search.py
   ```

5. âš ï¸ **Day8**ï¼šé‡æ–°æ‹ŸåˆÎ±(u)ï¼ˆä¾èµ–Day7ï¼‰
   ```bash
   python scripts/emg_fit_alpha_u.py
   ```

### éªŒè¯æ­¥éª¤

6. âœ… **åˆ†æq0 vs q_PKRI**ï¼šå¯¹æ¯”ä¼˜åŒ–å‰å
   ```bash
   python scripts/analyze_q0_vs_qpkri.py ...
   ```

7. âœ… **è¯„ä¼°EMGæ•ˆæœ**ï¼šéªŒè¯ä¼˜åŒ–1å’Œ2çš„æ”¹è¿›
   ```bash
   python scripts/eval_emg.py ... --knowledge-source qpkri
   ```

---

## ğŸ¯ éªŒè¯ä¼˜åŒ–1å’Œ2æ•ˆæœçš„æŒ‡æ ‡

### ä¼˜åŒ–1ï¼ˆå¯ä¿¡åº¦æ˜ å°„æ”¹è¿›ï¼‰éªŒè¯æŒ‡æ ‡

- **å¯ä¿¡åº¦åˆ†å¸ƒ**ï¼š
  - èŒƒå›´æ˜¯å¦æ‰©å±•ï¼ˆç›®æ ‡ï¼š[0.3, 0.9]ï¼‰
  - æ ‡å‡†å·®æ˜¯å¦æå‡ï¼ˆç›®æ ‡ï¼š>0.1ï¼Œä¹‹å‰ä»…0.0195ï¼‰
  - é«˜/ä½å¯ä¿¡åº¦æ ·æœ¬åŒºåˆ†åº¦

### ä¼˜åŒ–2ï¼ˆq_PKRIæ„å»ºå…¬å¼æ”¹è¿›ï¼‰éªŒè¯æŒ‡æ ‡

- **q_PKRIæ¦‚ç‡åˆ†å¸ƒ**ï¼š
  - å¹³å‡maxæ¦‚ç‡æ˜¯å¦æå‡ï¼ˆç›®æ ‡ï¼š>0.65ï¼Œä¹‹å‰ä»…0.57ï¼‰
  - æ˜¯å¦æ›´æ¥è¿‘q0ï¼ˆå·®å¼‚<0.1ï¼Œä¹‹å‰-0.22ï¼‰
- **å‡†ç¡®ç‡**ï¼š
  - q_PKRIå‡†ç¡®ç‡æ˜¯å¦æå‡ï¼ˆç›®æ ‡ï¼š>70%ï¼Œä¹‹å‰62.79%ï¼‰
  - æ˜¯å¦æ¥è¿‘q0å‡†ç¡®ç‡ï¼ˆä¹‹å‰69.38%ï¼‰

### ç»¼åˆéªŒè¯æŒ‡æ ‡

- **EMGèåˆæ•ˆæœ**ï¼š
  - EMG+q_PKRIæ˜¯å¦ä¼˜äºBaseline
  - æ˜¯å¦æ¥è¿‘æˆ–ä¼˜äºEMG+q0

---

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **è¯è¡¨è´¨é‡æå‡çš„é¢„æœŸå½±å“**ï¼š
   - q0è´¨é‡å¯èƒ½æå‡ï¼ˆå‡å°‘è¯¯åŒ¹é…ï¼‰
   - PKRIç‰¹å¾è´¨é‡æå‡ï¼ˆå‡å°‘å™ªå£°ç‰¹å¾ï¼‰
   - PKRIæ¨¡å‹è®­ç»ƒæ›´ç¨³å®š

2. **å¯¹æ¯”å®éªŒå»ºè®®**ï¼š
   - å¦‚æœè¦åšå¯¹æ¯”å®éªŒï¼Œå»ºè®®ä¿ç•™æ—§ç‰ˆæœ¬çš„è¾“å‡ºæ–‡ä»¶
   - æ–°ç‰ˆæœ¬æ–‡ä»¶å¯ä»¥åŠ åç¼€ï¼ˆå¦‚`qpkri_test_v2.jsonl`ï¼‰

3. **äº‘ç«¯è¿è¡Œ**ï¼š
   - ç¡®ä¿äº‘ç«¯è¯è¡¨å·²æ›´æ–°
   - æŒ‰é¡ºåºæ‰§è¡Œï¼Œé¿å…é—æ¼æ­¥éª¤

---

## ğŸš€ å¿«é€Ÿæ‰§è¡Œè„šæœ¬ï¼ˆäº‘ç«¯ï¼‰

å¯ä»¥åˆ›å»ºä¸€ä¸ªå®Œæ•´çš„é‡æ–°è¿è¡Œè„šæœ¬ï¼š

```bash
#!/bin/bash
# è¯è¡¨ä¼˜åŒ–åå®Œæ•´é‡æ–°è¿è¡Œè„šæœ¬

cd /mnt/workspace/EMG-PKRI
source venv/bin/activate

echo "=========================================="
echo "è¯è¡¨ä¼˜åŒ–åå®Œæ•´é‡æ–°è¿è¡Œ"
echo "=========================================="

# Day6: é‡æ–°ç”Ÿæˆq0
echo "Day6: é‡æ–°ç”Ÿæˆq0..."
python scripts/q0_builder.py --datasets train dev test

# Day7: é‡æ–°æœç´¢Î±*
echo "Day7: é‡æ–°æœç´¢Î±*..."
python scripts/emg_bucket_search.py

# Day8: é‡æ–°æ‹ŸåˆÎ±(u)
echo "Day8: é‡æ–°æ‹ŸåˆÎ±(u)..."
python scripts/emg_fit_alpha_u.py

# Day10-1: é‡æ–°ç”ŸæˆPKRIç‰¹å¾
echo "Day10-1: é‡æ–°ç”ŸæˆPKRIç‰¹å¾..."
python scripts/pkri_feature_builder.py \
    --dataset-file data/train_with_subtypes.jsonl \
    --lexicon-dir configs/lexicons \
    --output-file output/pkri_features_train.csv

python scripts/pkri_feature_builder.py \
    --dataset-file data/dev_with_subtypes.jsonl \
    --lexicon-dir configs/lexicons \
    --output-file output/pkri_features_dev.csv

python scripts/pkri_feature_builder.py \
    --dataset-file data/test_with_subtypes.jsonl \
    --lexicon-dir configs/lexicons \
    --output-file output/pkri_features_test.csv

# Day10-2: é‡æ–°è®­ç»ƒPKRIæ¨¡å‹ï¼ˆä½¿ç”¨ä¼˜åŒ–1å’Œ2ï¼‰
echo "Day10-2: é‡æ–°è®­ç»ƒPKRIæ¨¡å‹ï¼ˆä¼˜åŒ–1å’Œ2ï¼‰..."
python scripts/pkri_train.py \
    --train-features output/pkri_features_train.csv \
    --dev-features output/pkri_features_dev.csv \
    --test-features output/pkri_features_test.csv \
    --train-dataset data/train_with_subtypes.jsonl \
    --dev-dataset data/dev_with_subtypes.jsonl \
    --test-dataset data/test_with_subtypes.jsonl \
    --model-type lr \
    --calibration-method platt \
    --output-model output/pkri_model.pkl \
    --output-qpkri-dir data \
    --confidence-mapping tanh \
    --build-method improved_weighted

echo "=========================================="
echo "é‡æ–°è¿è¡Œå®Œæˆ"
echo "=========================================="
```

