# 项目进度清单

**最后更新**：2025-12-14

---

## ✅ 已完成任务

### Day1: 数据准备
- [x] TXT 转 JSONL 脚本 (txt_to_jsonl.py)
- [x] 数据清洗脚本 (data_cleaner.py)
- [x] 主标签标注脚本 (coarse_label.py)
- [x] 子标签标注脚本 (subtype_assign.py)
- [x] 数据集划分脚本 (dataset_split.py)
- [x] 困难集构建脚本 (hardset_maker.py)
- [x] 生成完整数据集（train: 39,583, dev: 4,948, test: 4,948）

### Day2: Baseline 训练
- [x] Baseline 训练脚本 (baseline_train.py)
- [x] 使用 Qwen-1.7B + LoRA 微调
- [x] 验证集 F1: 88.3%
- [x] 保存模型 checkpoint

### Day3: Baseline 评估
- [x] Baseline 评估脚本 (eval_baseline.py)
- [x] 测试集 F1: 89.13%
- [x] 高置信错误样本分析
- [x] 生成完整评估报告

### Day4: 不确定性分析
- [x] 不确定性分析脚本 (uncertainty_analysis.py)
- [x] 不确定性 u 与错误率相关性分析
- [x] 相关系数: 0.8379（强正相关）
- [x] 不确定性分桶分析
- [x] 生成 uncertainty 文件

### Day5: 校准分析
- [x] 校准分析脚本 (calibration_analysis.py)
- [x] ECE/MCE 计算逻辑
- [x] 单元测试通过
- [ ] ⚠️ 实际运行（脚本已完成，待运行）

### Day6: 知识后验构建
- [x] 词表生成脚本 (lexicon_generator.py)
- [x] 知识后验构建脚本 (q0_builder.py)
- [x] 生成 q₀ 文件（train/dev/test）
- [x] 参数调整和优化

### Day7: EMG α 搜索
- [x] α 搜索脚本 (emg_bucket_search.py)
- [x] 分桶搜索最优 α*
- [x] 生成 bucket_alpha_star.csv
- [x] 结果符合理论预期

### Day8: PAV 拟合
- [x] PAV 拟合脚本 (emg_fit_alpha_u.py)
- [x] 保序回归算法实现
- [x] 生成 α(u) 查表（100 个点）
- [x] 生成可视化曲线图
- [x] 单调递减性验证

### Day9: EMG 效果验证
- [x] EMG 评估脚本 (eval_emg.py)
- [x] 三种方法对比（Baseline、固定α、EMG）
- [x] 完整指标计算（F1、NLL、ECE）
- [x] 生成对比分析和图表
- [x] q₀ 参数调整和验证
- [x] 改进效果验证

### 代码质量
- [x] 所有核心脚本实现完成
- [x] 单元测试覆盖主要逻辑
- [x] 代码注释和文档完整
- [x] 支持云端和本地运行

---

## ⚠️ 待完成任务

### 短期优化
- [ ] **验证高不确定性切片表现**
  - 分别分析低不确定性（u < 0.1）和高不确定性（u ≥ 0.1）样本
  - 验证 EMG 在高不确定性样本上的效果

- [ ] **进一步优化 q₀ 质量**
  - 词表清洗和审核
  - 验证 q₀ 的 Precision/Recall（使用 eval_q0.py）
  - 尝试更精细的概率计算策略

- [ ] **运行 Day5 校准分析**
  - 运行 calibration_analysis.py
  - 分析 baseline 的校准误差（ECE/MCE）

### 中期改进
- [ ] **改进门控模型**
  - 考虑 p 和 q₀ 的置信度差异
  - 考虑 p 和 q₀ 的一致性
  - 尝试非线性融合策略

- [ ] **分析失败案例**
  - 找出哪些样本上 EMG 表现不佳
  - 针对性改进策略

- [ ] **尝试不同的不确定性指标**
  - u_entropy（熵）
  - u_margin（边际）
  - 对比不同指标的效果

### 长期扩展
- [ ] **Day10-Day12 相关任务**（根据需求）
- [ ] **边缘部署优化**（根据需求）
- [ ] **PKRI 模块实现**（根据需求）

---

## 📊 关键指标总结

| 指标 | 值 | 来源 |
|------|-----|------|
| Baseline F1 | 89.13% | Day3 |
| 不确定性相关系数 | 0.8379 | Day4 |
| EMG NLL 改善 | -2.72% | Day9 |
| EMG ECE 改善 | -11.16% | Day9 |
| EMG F1 变化 | -1.11% | Day9 |

---

**状态**：✅ 核心功能已完成，正在进行优化改进

