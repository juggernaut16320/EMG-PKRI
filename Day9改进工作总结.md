# Day9æ”¹è¿›å·¥ä½œæ€»ç»“

**æ›´æ–°æ—¶é—´**ï¼š2025-12-14

---

## âœ… å·²å®Œæˆçš„å·¥ä½œ

### 1. æ–‡æ¡£æ›´æ–°
- âœ… æ›´æ–°æ‰€æœ‰ç›¸å…³æ–‡æ¡£ï¼Œå°†é—¨æ§ä¼˜åŒ–çº³å…¥Day9
- âœ… ä¿®æ”¹é¡¹ç›®è¿›åº¦æ¸…å•ã€å®éªŒæ€»ç»“ã€æŠ€æœ¯æ–‡æ¡£ã€å®éªŒåˆ†æ

### 2. çŸ¥è¯†é˜ˆå€¼é—¨æ§å®ç°
- âœ… åˆ›å»º `scripts/search_knowledge_threshold.py` è„šæœ¬
  - åœ¨éªŒè¯é›†ä¸Šæœç´¢æœ€ä¼˜çŸ¥è¯†é˜ˆå€¼
  - æ”¯æŒF1æˆ–NLLä½œä¸ºä¼˜åŒ–æŒ‡æ ‡
  - è¾“å‡ºæœ€ä¼˜é˜ˆå€¼å’Œæ‰€æœ‰å€™é€‰é˜ˆå€¼çš„æŒ‡æ ‡

### 3. eval_emg.py é—¨æ§æ”¯æŒ
- âœ… æ·»åŠ çŸ¥è¯†é˜ˆå€¼é—¨æ§å‚æ•°æ”¯æŒ
  - `--knowledge-threshold-file`: ä»æ–‡ä»¶åŠ è½½é˜ˆå€¼
  - `--knowledge-threshold`: ç›´æ¥æŒ‡å®šé˜ˆå€¼
- âœ… æ·»åŠ ä¸€è‡´æ€§é—¨æ§å‚æ•°æ”¯æŒ
  - `--use-consistency-gating`: å¯ç”¨ä¸€è‡´æ€§æ£€æŸ¥
- âœ… ä¿®æ”¹ `evaluate_method` å‡½æ•°æ”¯æŒé—¨æ§é€»è¾‘
- âœ… ä¿®æ”¹ `evaluate_by_uncertainty_slices` å‡½æ•°æ”¯æŒé—¨æ§

---

## ğŸ“‹ ä¸‹ä¸€æ­¥å·¥ä½œ

### 1. æµ‹è¯•çŸ¥è¯†é˜ˆå€¼æœç´¢ï¼ˆæ¨èå…ˆåšï¼‰

**åœ¨äº‘ç«¯è¿è¡ŒçŸ¥è¯†é˜ˆå€¼æœç´¢**ï¼š

```bash
# 1. æ¿€æ´»ç¯å¢ƒ
cd /mnt/workspace/EMG-PKRI
source venv/bin/activate

# 2. æœç´¢æœ€ä¼˜çŸ¥è¯†é˜ˆå€¼
python scripts/search_knowledge_threshold.py \
    --dev-file output/dev_with_uncertainty.jsonl \
    --q0-file data/q0_dev.jsonl \
    --alpha-lut-file output/alpha_u_lut.json \
    --output-dir output
```

**é¢„æœŸè¾“å‡º**ï¼š
- `output/knowledge_threshold.json`: åŒ…å«æœ€ä¼˜é˜ˆå€¼å’Œæ‰€æœ‰å€™é€‰é˜ˆå€¼çš„æŒ‡æ ‡

### 2. ä½¿ç”¨é—¨æ§ä¼˜åŒ–é‡æ–°è¯„ä¼°ï¼ˆç¬¬äºŒæ­¥ï¼‰

**ä½¿ç”¨å­¦ä¹ åˆ°çš„é˜ˆå€¼è¯„ä¼°æµ‹è¯•é›†**ï¼š

```bash
# ä½¿ç”¨çŸ¥è¯†é˜ˆå€¼é—¨æ§
python scripts/eval_emg.py \
    --baseline-file output/test_with_uncertainty.jsonl \
    --q0-file data/q0_test.jsonl \
    --alpha-lut-file output/alpha_u_lut.json \
    --knowledge-threshold-file output/knowledge_threshold.json \
    --output-dir output
```

**åŒæ—¶å¯ç”¨ä¸¤ç§é—¨æ§**ï¼š

```bash
python scripts/eval_emg.py \
    --baseline-file output/test_with_uncertainty.jsonl \
    --q0-file data/q0_test.jsonl \
    --alpha-lut-file output/alpha_u_lut.json \
    --knowledge-threshold-file output/knowledge_threshold.json \
    --use-consistency-gating \
    --output-dir output
```

### 3. å¯¹æ¯”åˆ†æï¼ˆç¬¬ä¸‰æ­¥ï¼‰

**å¯¹æ¯”ä»¥ä¸‹æ–¹æ³•**ï¼š
1. Baselineï¼ˆåŸå§‹ï¼‰
2. EMGï¼ˆæ— é—¨æ§ï¼‰
3. EMG + çŸ¥è¯†é˜ˆå€¼é—¨æ§
4. EMG + ä¸€è‡´æ€§é—¨æ§
5. EMG + ä¸¤ç§é—¨æ§

**å…³æ³¨æŒ‡æ ‡**ï¼š
- F1 æå‡
- NLL é™ä½
- ECE é™ä½
- é«˜ä¸ç¡®å®šæ€§åˆ‡ç‰‡çš„è¡¨ç°

---

## ğŸ¯ é¢„æœŸæ”¹è¿›æ•ˆæœ

### çŸ¥è¯†é˜ˆå€¼é—¨æ§
- **ç›®æ ‡**ï¼šé¿å…ä½¿ç”¨å¼±çŸ¥è¯†ï¼ˆmax(qâ‚€) < thresholdæ—¶ï¼‰
- **é¢„æœŸ**ï¼šå‡å°‘qâ‚€å™ªå£°çš„å½±å“ï¼Œç‰¹åˆ«æ˜¯åœ¨é«˜uåˆ‡ç‰‡

### ä¸€è‡´æ€§é—¨æ§
- **ç›®æ ‡**ï¼šé¿å…på’Œqâ‚€é¢„æµ‹å†²çªæ—¶çš„å™ªå£°
- **é¢„æœŸ**ï¼šå‡å°‘F1æŸå¤±ï¼Œæé«˜åˆ†ç±»å‡†ç¡®ç‡

### ä¸¤ç§é—¨æ§ç»“åˆ
- **é¢„æœŸ**ï¼šç»¼åˆä¸¤ç§é—¨æ§çš„ä¼˜ç‚¹ï¼ŒåŒæ—¶æ”¹å–„F1å’Œæ¦‚ç‡è´¨é‡æŒ‡æ ‡

---

## ğŸ“ æ³¨æ„äº‹é¡¹

1. **çŸ¥è¯†é˜ˆå€¼æœç´¢åœ¨devé›†ä¸Šè¿›è¡Œ**ï¼šç¡®ä¿ä½¿ç”¨devé›†è€Œä¸æ˜¯testé›†
2. **è¯„ä¼°åœ¨testé›†ä¸Šè¿›è¡Œ**ï¼šä½¿ç”¨å­¦ä¹ åˆ°çš„é˜ˆå€¼åœ¨testé›†ä¸Šè¯„ä¼°
3. **å¯¹æ¯”æ—¶ä¿æŒä¸€è‡´æ€§**ï¼šä½¿ç”¨ç›¸åŒçš„testé›†å’Œqâ‚€æ–‡ä»¶è¿›è¡Œæ‰€æœ‰æ–¹æ³•çš„å¯¹æ¯”

---

## ğŸ” ç»“æœåˆ†æè¦ç‚¹

1. **æœ€ä¼˜é˜ˆå€¼æ˜¯å¤šå°‘ï¼Ÿ** å¦‚æœæ¥è¿‘0.5-0.7ï¼Œè¯´æ˜é—¨æ§æœ‰æ•ˆ
2. **F1æ˜¯å¦æå‡ï¼Ÿ** ç†æƒ³æƒ…å†µä¸‹åº”è¯¥æå‡æˆ–è‡³å°‘ä¸ä¸‹é™
3. **NLL/ECEæ˜¯å¦æ”¹å–„ï¼Ÿ** åº”è¯¥ä¿æŒæˆ–è¿›ä¸€æ­¥æ”¹å–„
4. **é«˜uåˆ‡ç‰‡è¡¨ç°å¦‚ä½•ï¼Ÿ** è¿™æ˜¯å…³é”®éªŒè¯ç‚¹

