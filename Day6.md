### Day6 è¦å®Œæˆçš„ä»£ç ï¼ˆæ„é€ è§„åˆ™ç‰ˆçŸ¥è¯†åéªŒ qâ‚€(c|z)ï¼‰

> **ç¯å¢ƒå‡†å¤‡**ï¼šå¼€å§‹å‰è¯·ç¡®ä¿å·²æ¿€æ´» conda ç¯å¢ƒï¼š`conda activate emgpkri`ï¼ˆæˆ–æ¿€æ´» venvï¼š`source venv/bin/activate`ï¼‰

```text
project/
â”‚
â”œâ”€â”€ data/
â”‚   â”œâ”€â”€ train.jsonl
â”‚   â”œâ”€â”€ dev.jsonl
â”‚   â”œâ”€â”€ test.jsonl
â”‚   â”œâ”€â”€ hard_eval_set.jsonl
â”‚   â”œâ”€â”€ q0_train.jsonl          # è¾“å‡º
â”‚   â”œâ”€â”€ q0_dev.jsonl            # è¾“å‡º
â”‚   â”œâ”€â”€ q0_test.jsonl           # è¾“å‡º
â”‚   â””â”€â”€ q0_hard.jsonl           # è¾“å‡º
â”‚
â”œâ”€â”€ configs/
â”‚   â”œâ”€â”€ config.yaml
â”‚   â””â”€â”€ lexicons/
â”‚       â”œâ”€â”€ porn.txt            # è¯è¡¨æ–‡ä»¶
â”‚       â”œâ”€â”€ politics.txt         # è¯è¡¨æ–‡ä»¶
â”‚       â”œâ”€â”€ abuse.txt           # è¯è¡¨æ–‡ä»¶
â”‚       â””â”€â”€ regex_patterns.txt  # æ­£åˆ™è§„åˆ™ï¼ˆå¯é€‰ï¼‰
â”‚
â”œâ”€â”€ scripts/
â”‚   â”œâ”€â”€ lexicon_generator.py    # å‰ç½®ä»»åŠ¡ï¼šç”Ÿæˆè¯è¡¨
â”‚   â””â”€â”€ q0_builder.py           # ä¸»è„šæœ¬ï¼šæ„å»ºçŸ¥è¯†åéªŒ
â”‚
â””â”€â”€ requirements.txt
```

### ä»»åŠ¡ 1ï¼šç”Ÿæˆè¯è¡¨å’Œæ­£åˆ™è§„åˆ™ï¼ˆå‰ç½®ä»»åŠ¡ï¼‰

**è„šæœ¬ï¼š** `scripts/lexicon_generator.py`

**åŠŸèƒ½ï¼š**
- ä»æ ‡æ³¨æ•°æ®ä¸­æŒ‰ç±»åˆ«é‡‡æ ·æ ·æœ¬
- è°ƒç”¨å¤§æ¨¡å‹ç”Ÿæˆè¯è¡¨å’Œæ­£åˆ™è§„åˆ™
- æ”¯æŒå¼‚æ­¥æ‰¹å¤„ç†ï¼Œå¸¦è¶…æ—¶è·³è¿‡
- **è¯è¡¨æ¸…æ´—**ï¼šä½¿ç”¨ LLM æ¸…æ´—ç°æœ‰è¯è¡¨ï¼Œåˆ é™¤å™ªå£°è¯

**ä½¿ç”¨æ–¹å¼ï¼š**

```bash
# åŸºæœ¬ä½¿ç”¨ï¼ˆç”Ÿæˆæ‰€æœ‰ç±»åˆ«çš„è¯è¡¨ï¼‰
python scripts/lexicon_generator.py

# æŒ‡å®šè¾“å…¥æ–‡ä»¶å’Œè¾“å‡ºç›®å½•
python scripts/lexicon_generator.py \
    --input data/train.jsonl \
    --output-dir configs/lexicons

# æŒ‡å®šç±»åˆ«å’Œé‡‡æ ·æ•°é‡
python scripts/lexicon_generator.py \
    --categories porn politics abuse \
    --samples-per-category 100

# åŒæ—¶ç”Ÿæˆæ­£åˆ™è§„åˆ™
python scripts/lexicon_generator.py --generate-regex

# æ¸…æ´—ç°æœ‰è¯è¡¨ï¼ˆä½¿ç”¨LLMåˆ¤æ–­ï¼Œåˆ é™¤å™ªå£°è¯ï¼‰
python scripts/lexicon_generator.py \
    --clean-lexicon \
    --lexicon-dir configs/lexicons \
    --categories porn politics abuse \
    --clean-batch-size 100 \
    --backup-original

# æ¸…æ´—å•ä¸ªç±»åˆ«
python scripts/lexicon_generator.py \
    --clean-lexicon \
    --lexicon-dir configs/lexicons \
    --categories porn \
    --clean-batch-size 100
```

**è¾“å‡ºï¼š**
- `configs/lexicons/porn.txt` - è‰²æƒ…ç›¸å…³è¯è¡¨
- `configs/lexicons/politics.txt` - æ¶‰æ”¿ç›¸å…³è¯è¡¨
- `configs/lexicons/abuse.txt` - è¾±éª‚ç›¸å…³è¯è¡¨
- `configs/lexicons/regex_patterns.txt` - æ­£åˆ™è§„åˆ™ï¼ˆå¯é€‰ï¼‰

**è¯è¡¨æ¸…æ´—åŠŸèƒ½è¯´æ˜ï¼š**

**ä¸ºä»€ä¹ˆè¦æ¸…æ´—è¯è¡¨ï¼Ÿ**

1. **æé«˜åŒ¹é…æ•ˆç‡**ï¼š
   - åŸå§‹ç”Ÿæˆçš„è¯è¡¨å¯èƒ½åŒ…å«å¤§é‡å™ªå£°è¯ï¼ˆå•å­—ç¬¦ã€è¡¨æƒ…ç¬¦å·ã€ç¼–å·ç­‰ï¼‰
   - è¯è¡¨è¿‡å¤§ï¼ˆ10ä¸‡+è¯ï¼‰ä¼šæ˜¾è‘—é™ä½åŒ¹é…é€Ÿåº¦
   - æ¸…æ´—åè¯è¡¨å‡å°‘ 70-85%ï¼ŒåŒ¹é…æ•ˆç‡æå‡ 3-5 å€

2. **å‡å°‘è¯¯æŠ¥**ï¼š
   - åˆ é™¤æ­£å¸¸è¯æ±‡ï¼ˆå¦‚ï¼šè¿è¡£è£™ã€åˆ·ç‰™ã€æ”»ç•¥ï¼‰é¿å…è¯¯æŠ¥
   - åˆ é™¤æ— æ„ä¹‰çš„ç¼–å·/ä»£ç ï¼ˆå¦‚ï¼šABF-061ï¼‰é¿å…è¯¯åŒ¹é…
   - ä¿ç•™çœŸæ­£çš„æ•æ„Ÿè¯åŠå…¶å˜ä½“

3. **æå‡ qâ‚€ è´¨é‡**ï¼š
   - å™ªå£°è¯ä¼šå¯¼è‡´ qâ‚€ è®¡ç®—ä¸å‡†ç¡®
   - æ¸…æ´—åçš„è¯è¡¨æ›´ç²¾å‡†ï¼Œqâ‚€ åéªŒæ›´å¯é 

**æ¸…æ´—ç­–ç•¥ï¼š**

1. **é¢„å¤„ç†è¿‡æ»¤**ï¼ˆå¿«é€Ÿåˆ é™¤æ˜æ˜¾å™ªå£°ï¼‰ï¼š
   - å•å­—ç¬¦è¯ï¼ˆA, B, +, @ï¼‰
   - è¡¨æƒ…ç¬¦å·ï¼ˆğŸ˜‚, ğŸ˜, ğŸ”¥ï¼‰
   - ç¼–å·æ ¼å¼ï¼ˆABF-061, ALDN-290ï¼‰
   - çº¯æ•°å­—æˆ–çŸ­å­—æ¯ï¼ˆâ‰¤2å­—ç¬¦ï¼‰

2. **LLM æ™ºèƒ½åˆ¤æ–­**ï¼ˆå¤„ç†è¾¹ç•Œæƒ…å†µï¼‰ï¼š
   - æ­£å¸¸è¯æ±‡è¯¯æŠ¥ï¼ˆè¿è¡£è£™ã€åˆ·ç‰™ç­‰ï¼‰
   - ä¸Šä¸‹æ–‡ç›¸å…³çš„æ•æ„Ÿè¯åˆ¤æ–­
   - æ¨¡ç³Šè¯æ±‡çš„ä¿ç•™/åˆ é™¤å†³ç­–

**æ¸…æ´—æµç¨‹ï¼š**

1. è¯»å–åŸå§‹è¯è¡¨æ–‡ä»¶
2. é¢„å¤„ç†è¿‡æ»¤æ˜æ˜¾å™ªå£°ï¼ˆå¿«é€Ÿï¼‰
3. åˆ†æ‰¹å‘é€ç»™ LLM åˆ¤æ–­ï¼ˆæ¯æ‰¹100ä¸ªè¯ï¼Œå¯é…ç½®ï¼‰
4. LLM åªè¿”å›è¦ä¿ç•™çš„è¯ï¼ˆèŠ‚çœtokenï¼‰
5. ç»“æœé€æ¬¡è¿½åŠ åˆ°ä¸´æ—¶æ–‡ä»¶
6. æœ€åç”¨ set å»é‡å¹¶è¦†ç›–åŸæ–‡ä»¶

**çŠ¶æ€ï¼š** âœ… å·²å®Œæˆï¼ˆå·²å®ç°å¼‚æ­¥ç‰ˆæœ¬ï¼Œæ”¯æŒè¶…æ—¶è·³è¿‡ï¼Œæ”¯æŒè¯è¡¨æ¸…æ´—ï¼‰

---

### ä»»åŠ¡ 2ï¼šæ„å»ºçŸ¥è¯†åéªŒ qâ‚€ï¼ˆä¸»ä»»åŠ¡ï¼‰

**è„šæœ¬ï¼š** `scripts/q0_builder.py`

**åŠŸèƒ½ï¼š**
- åŸºäºè¯è¡¨åŒ¹é…æ„é€ çŸ¥è¯†ä¿¡å·
- åŸºäºæ­£åˆ™è§„åˆ™åŒ¹é…ï¼ˆå¯é€‰ï¼‰
- è¾“å‡º coarse äºŒåˆ†ç±»æ¦‚ç‡ï¼š[p_non_sensitive, p_sensitive]
- å¯¹ train/dev/test/hardset å…¨éƒ¨ç”Ÿæˆ qâ‚€ åéªŒ

**å…³é”®ç‰¹æ€§ï¼š**

- **è¯è¡¨åŒ¹é…**ï¼šæ£€æŸ¥æ–‡æœ¬ä¸­æ˜¯å¦åŒ…å«è¯è¡¨ä¸­çš„è¯
  - æ”¯æŒå¤šä¸ªç±»åˆ«ï¼ˆporn/politics/abuseï¼‰
  - å¯æŒ‰ç±»åˆ«è®¾è®¡ä¸åŒå¼ºåº¦æƒé‡
- **æ­£åˆ™åŒ¹é…**ï¼šä½¿ç”¨æ­£åˆ™è§„åˆ™åŒ¹é…å˜ä½“å½¢å¼ï¼ˆå¯é€‰ï¼‰
- **æ¦‚ç‡è®¡ç®—**ï¼šåŸºäºåŒ¹é…ç»“æœè®¡ç®—æ•æ„Ÿæ¦‚ç‡
  - è¾“å‡ºæ ¼å¼ï¼š`[p_non_sensitive, p_sensitive]`
  - ä¾‹å¦‚ï¼š`[0.2, 0.8]` è¡¨ç¤º 80% æ¦‚ç‡ä¸ºæ•æ„Ÿ
- **æ‰¹é‡å¤„ç†**ï¼šæ”¯æŒå¯¹å¤šä¸ªæ•°æ®é›†æ‰¹é‡ç”Ÿæˆ qâ‚€ åéªŒ

**ä½¿ç”¨æ–¹å¼ï¼š**

```bash
# åŸºæœ¬ä½¿ç”¨ï¼ˆä» config.yaml è¯»å–æ‰€æœ‰å‚æ•°ï¼‰
python scripts/q0_builder.py

# æŒ‡å®šæ•°æ®æ–‡ä»¶å’Œè¯è¡¨ç›®å½•
python scripts/q0_builder.py \
    --train-file data/train.jsonl \
    --dev-file data/dev.jsonl \
    --test-file data/test.jsonl \
    --hard-file data/hard_eval_set.jsonl \
    --lexicon-dir configs/lexicons

# æŒ‡å®šè¾“å‡ºç›®å½•
python scripts/q0_builder.py \
    --output-dir data

# è‡ªå®šä¹‰æƒé‡
python scripts/q0_builder.py \
    --porn-weight 1.0 \
    --politics-weight 0.8 \
    --abuse-weight 0.6

# å¯ç”¨æ­£åˆ™è§„åˆ™åŒ¹é…
python scripts/q0_builder.py --use-regex

# åªå¤„ç†ç‰¹å®šæ•°æ®é›†
python scripts/q0_builder.py --datasets train dev
```

**è¾“å…¥æ ¼å¼ï¼š**

**ä½ç½®ï¼š** `data/train.jsonl`, `data/dev.jsonl`, `data/test.jsonl`, `data/hard_eval_set.jsonl`

**æ ¼å¼ï¼š** JSONLï¼ˆæ¯è¡Œä¸€ä¸ª JSON å¯¹è±¡ï¼‰

**å¿…éœ€å­—æ®µï¼š**
- `id`: æ ·æœ¬ ID
- `text`: æ–‡æœ¬å†…å®¹

**å¯é€‰å­—æ®µï¼š**
- `coarse_label`: æ ‡ç­¾ï¼ˆ0=éæ•æ„Ÿ, 1=æ•æ„Ÿï¼‰ï¼Œç”¨äºéªŒè¯
- `subtype_label`: å­æ ‡ç­¾åˆ—è¡¨ï¼Œç”¨äºåˆ†æ

**è¯è¡¨æ–‡ä»¶æ ¼å¼ï¼š**

**ä½ç½®ï¼š** `configs/lexicons/`

**æ ¼å¼ï¼š** æ¯è¡Œä¸€ä¸ªè¯

**ç¤ºä¾‹ï¼š**
```
porn.txt:
è‰²æƒ…
av
xxx
...

politics.txt:
æ”¿æ²»
æ¶‰æ”¿
...

abuse.txt:
è¾±éª‚
æ”»å‡»
...
```

**æ­£åˆ™è§„åˆ™æ–‡ä»¶æ ¼å¼ï¼ˆå¯é€‰ï¼‰ï¼š**

**ä½ç½®ï¼š** `configs/lexicons/regex_patterns.txt`

**æ ¼å¼ï¼š** æ¯è¡Œä¸€ä¸ªæ­£åˆ™è§„åˆ™ï¼Œæ ¼å¼ï¼š`pattern|description`

**ç¤ºä¾‹ï¼š**
```
cao|è‰|æ“|åŒ¹é…æ‹¼éŸ³å˜ä½“
f[u*]ck|f[u*]k|åŒ¹é…è°éŸ³å˜ä½“
...
```

**è¾“å‡ºæ ¼å¼ï¼š**

**ä½ç½®ï¼š** `data/q0_train.jsonl`, `data/q0_dev.jsonl`, `data/q0_test.jsonl`, `data/q0_hard.jsonl`

**æ ¼å¼ï¼š** JSONLï¼ˆæ¯è¡Œä¸€ä¸ª JSON å¯¹è±¡ï¼‰

**ç»“æ„ï¼š**
```json
{
  "id": "s1898",
  "text": "åŸå§‹æ–‡æœ¬å†…å®¹",
  "coarse_label": 1,
  "q0": [0.2, 0.8],
  "q0_details": {
    "porn_matches": ["è‰²æƒ…", "av"],
    "politics_matches": [],
    "abuse_matches": [],
    "regex_matches": [],
    "total_matches": 2,
    "match_score": 0.8
  }
}
```

**å­—æ®µè¯´æ˜ï¼š**
- `q0`: çŸ¥è¯†åéªŒæ¦‚ç‡ `[p_non_sensitive, p_sensitive]`
- `q0_details`: åŒ¹é…è¯¦æƒ…ï¼ˆå¯é€‰ï¼‰
  - `porn_matches`: åŒ¹é…åˆ°çš„è‰²æƒ…ç›¸å…³è¯
  - `politics_matches`: åŒ¹é…åˆ°çš„æ¶‰æ”¿ç›¸å…³è¯
  - `abuse_matches`: åŒ¹é…åˆ°çš„è¾±éª‚ç›¸å…³è¯
  - `regex_matches`: åŒ¹é…åˆ°çš„æ­£åˆ™è§„åˆ™
  - `total_matches`: æ€»åŒ¹é…æ•°
  - `match_score`: åŒ¹é…åˆ†æ•°

**é…ç½®å‚æ•°ï¼ˆconfig.yamlï¼‰ï¼š**

```yaml
# çŸ¥è¯†åéªŒ qâ‚€ é…ç½®ï¼ˆDay6ï¼‰
q0:
  lexicon_dir: "configs/lexicons"  # è¯è¡¨ç›®å½•
  use_regex: false                 # æ˜¯å¦ä½¿ç”¨æ­£åˆ™è§„åˆ™
  porn_weight: 1.0                 # è‰²æƒ…ç±»åˆ«æƒé‡
  politics_weight: 0.8             # æ¶‰æ”¿ç±»åˆ«æƒé‡
  abuse_weight: 0.6                 # è¾±éª‚ç±»åˆ«æƒé‡
  base_sensitive_prob: 0.1         # åŸºç¡€æ•æ„Ÿæ¦‚ç‡ï¼ˆæ— åŒ¹é…æ—¶ï¼‰
  max_sensitive_prob: 0.95         # æœ€å¤§æ•æ„Ÿæ¦‚ç‡
  min_matches_for_sensitive: 1     # è§¦å‘æ•æ„Ÿçš„æœ€å°åŒ¹é…æ•°
  include_details: true             # æ˜¯å¦åŒ…å«åŒ¹é…è¯¦æƒ…
```

**å¢é‡åˆ†æè¯´æ˜ï¼š**

- **æ–°è¯è¡¨åŠ å…¥åï¼š**
  - åªéœ€é‡æ–°è¿è¡Œ `q0_builder.py` å³å¯è·å¾—æœ€æ–°çš„ qâ‚€ åéªŒ
  - æ— éœ€ä¿®æ”¹ä»£ç 

- **è¯è¡¨æ¸…æ´—åï¼š**
  - æ¸…æ´—åçš„è¯è¡¨ä¼šè¦†ç›–åŸæ–‡ä»¶ï¼ˆå»ºè®®ä½¿ç”¨ `--backup-original` å¤‡ä»½ï¼‰
  - é‡æ–°è¿è¡Œ `q0_builder.py` ä½¿ç”¨æ¸…æ´—åçš„è¯è¡¨ç”Ÿæˆ qâ‚€
  - æ¸…æ´—å¯å‡å°‘ 70-85% çš„å™ªå£°è¯ï¼Œæå‡åŒ¹é…æ•ˆç‡ 3-5 å€

- **æ–°æ•°æ®åŠ å…¥åï¼š**
  - é‡æ–°ç”Ÿæˆ `train/dev/test/hard_eval_set.jsonl`
  - é‡æ–°è¿è¡Œ `q0_builder.py` å³å¯

**å·¥ç¨‹/å®¹å™¨åŒ–çº¦å®šï¼š**

- æ‰€æœ‰è·¯å¾„ä» `config.yaml` æˆ– CLI å‚æ•°è¯»å–ï¼š
  - `data_dir`ï¼ˆé»˜è®¤ `./data`ï¼‰
  - `lexicon_dir`ï¼ˆé»˜è®¤ `configs/lexicons`ï¼‰
  - `output_dir`ï¼ˆé»˜è®¤ `./data`ï¼‰

- è¯è¡¨æ–‡ä»¶ï¼š
  - æ”¯æŒå¤šä¸ªç±»åˆ«ï¼ˆporn/politics/abuseï¼‰
  - æ”¯æŒåŠ¨æ€åŠ è½½ï¼Œè‡ªåŠ¨æ£€æµ‹å¯ç”¨è¯è¡¨

- è¾“å‡ºç›®å½•ï¼š
  - ç»Ÿä¸€ä½¿ç”¨ `data/` ç›®å½•
  - æ–¹ä¾¿äº‘ç«¯å’Œæœ¬åœ°ç»Ÿä¸€ä½¿ç”¨

**åˆ†æç›‘æ§ï¼š**

- å¤„ç†è¿‡ç¨‹ä¸­ä¼šè¾“å‡ºï¼š
  - æ¯ä¸ªæ•°æ®é›†çš„å¤„ç†è¿›åº¦
  - åŒ¹é…ç»Ÿè®¡ä¿¡æ¯
  - æ¦‚ç‡åˆ†å¸ƒç»Ÿè®¡

- å¤„ç†å®Œæˆåä¼šè¾“å‡ºï¼š
  - æ¯ä¸ªæ•°æ®é›†çš„ qâ‚€ ç»Ÿè®¡
  - åŒ¹é…è¯è¡¨ç»Ÿè®¡
  - è¾“å‡ºæ–‡ä»¶è·¯å¾„

**æ³¨æ„äº‹é¡¹ï¼š**

- **è¯è¡¨è´¨é‡ä¸æ¸…æ´—**ï¼š
  - qâ‚€ çš„æ•ˆæœé«˜åº¦ä¾èµ–è¯è¡¨å’Œæ­£åˆ™è§„åˆ™çš„è´¨é‡
  - **å»ºè®®å®šæœŸæ¸…æ´—è¯è¡¨**ï¼šä½¿ç”¨ `lexicon_generator.py --clean-lexicon` åˆ é™¤å™ªå£°è¯
  - æ¸…æ´—å¯å‡å°‘ 70-85% çš„å™ªå£°è¯ï¼ˆå•å­—ç¬¦ã€è¡¨æƒ…ç¬¦å·ã€æ­£å¸¸è¯æ±‡ç­‰ï¼‰
  - æ¸…æ´—åè¯è¡¨æ›´ç²¾å‡†ï¼ŒåŒ¹é…æ•ˆç‡æå‡ 3-5 å€ï¼Œå‡å°‘è¯¯æŠ¥
  - æ¸…æ´—åè¯·äººå·¥å®¡æ ¸ï¼Œç¡®ä¿æ²¡æœ‰è¯¯åˆ é‡è¦æ•æ„Ÿè¯

- **è¯è¡¨åŒ¹é…ç­–ç•¥ï¼š**
  - é»˜è®¤ä½¿ç”¨ç²¾ç¡®åŒ¹é…ï¼ˆåŒºåˆ†å¤§å°å†™ï¼‰
  - å¯ä»¥æ‰©å±•ä¸ºæ¨¡ç³ŠåŒ¹é…ã€è¯è¾¹ç•ŒåŒ¹é…ç­‰

- **æ¦‚ç‡è®¡ç®—ç­–ç•¥ï¼š**
  - åŸºäºåŒ¹é…æ•°é‡å’Œç±»åˆ«æƒé‡è®¡ç®—
  - å¯ä»¥ä½¿ç”¨ sigmoid å‡½æ•°å¹³æ»‘æ¦‚ç‡
  - å¯ä»¥è®¾ç½®é˜ˆå€¼ï¼Œè¶…è¿‡é˜ˆå€¼ç›´æ¥åˆ¤å®šä¸ºæ•æ„Ÿ

- **æ€§èƒ½ä¼˜åŒ–ï¼š**
  - è¯è¡¨åŒ¹é…ä½¿ç”¨é›†åˆæŸ¥æ‰¾ï¼ŒO(1) æ—¶é—´å¤æ‚åº¦
  - æ­£åˆ™åŒ¹é…å¯ä»¥é¢„ç¼–è¯‘ï¼Œæé«˜æ•ˆç‡
  - æ”¯æŒæ‰¹é‡å¤„ç†ï¼Œæé«˜ååé‡
  - **å¤§è¯è¡¨ä¼˜åŒ–**ï¼šä½¿ç”¨ `pyahocorasick` åº“ï¼ˆå·²é›†æˆï¼‰ï¼Œè¯è¡¨>10ä¸‡è¯æ—¶æ€§èƒ½æå‡ 100-1000 å€
  - **è¯è¡¨æ¸…æ´—**ï¼šå®šæœŸæ¸…æ´—è¯è¡¨ï¼Œåˆ é™¤å™ªå£°è¯ï¼Œå‡å°‘ 70-85% çš„è¯è¡¨å¤§å°ï¼Œæå‡åŒ¹é…æ•ˆç‡ 3-5 å€
  - **å¤§è¯è¡¨ä¼˜åŒ–**ï¼šä½¿ç”¨ `pyahocorasick` åº“ï¼ˆå·²é›†æˆï¼‰ï¼Œè¯è¡¨>10ä¸‡è¯æ—¶æ€§èƒ½æå‡ 100-1000 å€

- **ä¸ Day7 çš„å…³ç³»ï¼š**
  - Day6 ç”Ÿæˆ qâ‚€ åéªŒï¼Œä¸º EMG æä¾›çŸ¥è¯†é€šé“
  - Day7 ä½¿ç”¨ qâ‚€ å’Œ baseline çš„ p(c|x) è¿›è¡Œèåˆ
  - qâ‚€ çš„è´¨é‡ç›´æ¥å½±å“ EMG çš„æ•ˆæœ

---

## Day6 å®ç°æ¸…å•

### æ ¸å¿ƒåŠŸèƒ½å®ç°

- [x] **è¯è¡¨ç”Ÿæˆè„šæœ¬**ï¼ˆä»»åŠ¡1ï¼‰
  - [x] `lexicon_generator.py` å®ç°å®Œæˆ
  - [x] æ”¯æŒå¼‚æ­¥æ‰¹å¤„ç†
  - [x] æ”¯æŒè¶…æ—¶è·³è¿‡
  - [x] æ”¯æŒåŠ¨æ€è¿½åŠ åˆ°æ–‡ä»¶

- [x] **çŸ¥è¯†åéªŒæ„å»ºè„šæœ¬**ï¼ˆä»»åŠ¡2ï¼‰
  - [x] `q0_builder.py` å®ç°å®Œæˆ
  - [x] è¯è¡¨åŒ¹é…åŠŸèƒ½
  - [x] æ­£åˆ™è§„åˆ™åŒ¹é…åŠŸèƒ½ï¼ˆå¯é€‰ï¼‰
  - [x] æ¦‚ç‡è®¡ç®—åŠŸèƒ½
  - [x] æ‰¹é‡å¤„ç†åŠŸèƒ½
  - [x] è¾“å‡ºæ ¼å¼éªŒè¯

### æµ‹è¯•æ–‡ä»¶

- [ ] **test_q0_builder.py**
  - [ ] æµ‹è¯•è„šæœ¬åŸºæœ¬åŠŸèƒ½
  - [ ] æµ‹è¯•è¾“å…¥è¾“å‡ºæ ¼å¼
  - [ ] æµ‹è¯•é”™è¯¯å¤„ç†

- [ ] **test_q0_builder_logic.py**
  - [ ] æµ‹è¯•è¯è¡¨åŒ¹é…é€»è¾‘
  - [ ] æµ‹è¯•æ¦‚ç‡è®¡ç®—é€»è¾‘
  - [ ] æµ‹è¯•è¾¹ç•Œæƒ…å†µ

### æ–‡æ¡£å’Œç¤ºä¾‹

- [x] **Day6.md æ–‡æ¡£**ï¼ˆå½“å‰æ–‡æ¡£ï¼‰
- [ ] **é…ç½®æ–‡ä»¶æ›´æ–°**
  - [ ] åœ¨ config.yaml ä¸­æ·»åŠ  q0 é…ç½®
- [ ] **æ›´æ–° README**ï¼ˆå¦‚æœéœ€è¦ï¼‰

---

## çŸ¥è¯†åéªŒ qâ‚€ æ ¸å¿ƒå…¬å¼

### åŸºç¡€æ¦‚ç‡è®¡ç®—

```
å¦‚æœåŒ¹é…åˆ°è¯è¡¨æˆ–æ­£åˆ™ï¼š
  match_score = Î£(weight_i Ã— match_count_i) / total_words
  p_sensitive = base_sensitive_prob + (max_sensitive_prob - base_sensitive_prob) Ã— sigmoid(match_score)
å¦åˆ™ï¼š
  p_sensitive = base_sensitive_prob

p_non_sensitive = 1 - p_sensitive
q0 = [p_non_sensitive, p_sensitive]
```

å…¶ä¸­ï¼š
- `weight_i`: ç±»åˆ« i çš„æƒé‡ï¼ˆporn/politics/abuseï¼‰
- `match_count_i`: ç±»åˆ« i çš„åŒ¹é…æ•°é‡
- `total_words`: æ–‡æœ¬æ€»è¯æ•°
- `sigmoid(x)`: sigmoid å‡½æ•°ï¼Œå°†åˆ†æ•°æ˜ å°„åˆ° [0, 1]

### å¤šç±»åˆ«æƒé‡èåˆ

```
match_score = (porn_weight Ã— porn_matches + 
               politics_weight Ã— politics_matches + 
               abuse_weight Ã— abuse_matches) / total_words
```

---

## é¢„æœŸè¾“å‡ºç¤ºä¾‹

### qâ‚€ åéªŒç»Ÿè®¡

å‡è®¾è¾“å‡ºï¼š
```json
{
  "train": {
    "total_samples": 39584,
    "avg_p_sensitive": 0.35,
    "sensitive_samples": 14250,
    "non_sensitive_samples": 25334
  },
  "dev": {
    "total_samples": 4948,
    "avg_p_sensitive": 0.36,
    "sensitive_samples": 1781,
    "non_sensitive_samples": 3167
  }
}
```

**è§£è¯»ï¼š**
- å¹³å‡æ•æ„Ÿæ¦‚ç‡ä¸º 0.35-0.36ï¼Œè¯´æ˜è¯è¡¨åŒ¹é…æ•ˆæœåˆç†
- æ•æ„Ÿæ ·æœ¬å æ¯”çº¦ 36%ï¼Œä¸çœŸå®æ ‡ç­¾åˆ†å¸ƒæ¥è¿‘

### åŒ¹é…ç»Ÿè®¡

```json
{
  "porn_matches": 12345,
  "politics_matches": 5678,
  "abuse_matches": 2345,
  "regex_matches": 890,
  "total_matches": 21258
}
```

---

## ä¸ Day5 çš„å¯¹æ¯”

| ç‰¹æ€§ | Day5ï¼ˆæ ¡å‡†åˆ†æï¼‰ | Day6ï¼ˆçŸ¥è¯†åéªŒæ„å»ºï¼‰ |
|------|-----------------|---------------------|
| **åˆ†æç›®æ ‡** | é¢„æµ‹æ¦‚ç‡ p(c\|x) ä¸å®é™…å‡†ç¡®ç‡çš„æ ¡å‡† | åŸºäºè¯è¡¨åŒ¹é…æ„é€ çŸ¥è¯†åéªŒ qâ‚€ |
| **è¾“å…¥** | baseline é¢„æµ‹ç»“æœ | åŸå§‹æ–‡æœ¬ + è¯è¡¨æ–‡ä»¶ |
| **è¾“å‡º** | Reliability Diagram + ECE/MCE | qâ‚€ åéªŒæ¦‚ç‡ |
| **ç”¨é€”** | é‡åŒ–è¿‡åº¦è‡ªä¿¡é—®é¢˜ï¼Œä¸ºæ ¡å‡†æä¾›åŠ¨æœº | ä¸º EMG æä¾›çŸ¥è¯†é€šé“ |
| **å…³ç³»** | åˆ†æ baseline çš„æ ¡å‡†é—®é¢˜ | æ„å»ºçŸ¥è¯†ä¿¡å·ï¼Œä¸ºèåˆåšå‡†å¤‡ |

---

**æœ€åæ›´æ–°**ï¼š2025-12-14  
**çŠ¶æ€**ï¼šâœ… å·²å®Œæˆï¼ˆä»»åŠ¡1å’Œä»»åŠ¡2å‡å·²å®Œæˆï¼‰

**å®Œæˆæƒ…å†µæ€»ç»“ï¼š**
- âœ… ä»»åŠ¡1ï¼šè¯è¡¨ç”Ÿæˆï¼ˆlexicon_generator.pyï¼‰- å·²å®Œæˆ
- âœ… ä»»åŠ¡2ï¼šçŸ¥è¯†åéªŒæ„å»ºï¼ˆq0_builder.pyï¼‰- å·²å®Œæˆ
  - å·²æˆåŠŸç”Ÿæˆ q0_train.jsonl (39583æ¡)
  - å·²æˆåŠŸç”Ÿæˆ q0_dev.jsonl (4948æ¡)
  - å·²æˆåŠŸç”Ÿæˆ q0_test.jsonl (4948æ¡)
  - å¹³å‡æ•æ„Ÿæ¦‚ç‡ï¼štrain=0.8231, dev=0.8203, test=0.8174

